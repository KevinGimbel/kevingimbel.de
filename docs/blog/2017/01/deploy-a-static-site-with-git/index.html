<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Deploy a static site with git &mdash; KevOps â€” DevOps, Cooking, and everything else I want to write about</title><meta name=author content="Kevin Gimbel"><meta name=description content="Personal website of Kevin Gimbel, DevOps Engineer, about photography, books, coding, devops, gaming, and whatever comes in between"><meta keywords="git hugo deployment bash  blog coding tools devops"><link rel=icon href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn6eZ4oCN4pmC77iPPC90ZXh0Pjwvc3ZnPg=="><style type=text/css>*{margin:0;padding:0;box-sizing:inherit}:root{--color-main: #403D58;--color-secondary: #dea584;--color-bg-box: #fefefe;--color-bg-page: #f1f1f1;--color-font-fg: #fff}html,body{box-sizing:border-box;font:20px/1.65 sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;background:var(--color-bg-page);border:.5em solid var(--color-main)}::selection{background-color:var(--color-main);color:var(--color-secondary)}abbr{cursor:help;text-decoration:none;border-bottom:2px dotted var(--color-main)}a{color:var(--color-main);font-weight:700}.footer a,.author a,.intro-text a{color:var(--color-secondary);font-weight:700}.fg-accent{color:var(--color-secondary)}.x-small{font-size:.85rem}.xx-small{font-size:.65rem}.txt--ultra-large{font-size:4rem}.txt--large{font-size:2.5rem}.txt--medium{font-size:1.8rem}h1{font-size:2.46rem}h2{font-size:1.8rem}h3{font-size:1.6rem}.article-content h2,.article-content h3{margin-top:2rem}.section-headline{font-size:3.75em;margin-top:2rem}.intro-splash{display:block;min-height:90vh;display:flex;align-items:center}.intro-text{padding:2rem;background:#222;color:var(--color-font-fg);font-size:140%}.footer{padding:2rem}hr{border:none;background:var(--color-main);height:2px}.footer{background:#222;color:var(--color-font-fg)}.main{border-bottom:0;min-height:100vh}.main p{margin-top:1rem;margin-bottom:1.5rem}.exif{padding:.5rem;background:var(--color-secondary)}.exif li{display:inline-block;background:#333;color:#ccc;border-radius:3px;padding:.125rem .5rem;font-size:.8rem}.exif .label{font-size:.75rem}@media all and (max-width:800px){.exif li{margin-top:.5rem}.gallery img{max-width:100%;max-width:calc(100% + 2rem)}}figure img,figure picture{display:block;height:auto;width:auto;max-width:100%}.art figure img,.art figure picture,.photography figure img,.photography figure picture{width:auto;max-width:calc(100% + 2rem + 1px)}figcaption p{display:block;line-height:1.65;background:var(--color-secondary);color:var(--color-font-fg);margin-top:0;padding:.5rem;text-align:right;font-size:var(--font-small,.85rem)}figure{position:relative;z-index:1;margin-left:calc(0rem - 2rem)}figure+figure{margin-top:2rem}figcaption{display:flex;justify-content:flex-end}figcaption p{background:var(--color-secondary);color:var(--color-main);font-size:.85em;margin-top:1.5rem;position:relative}figcaption p::before{content:"";width:.15em;height:10rem;background:var(--color-secondary);position:absolute;left:0;top:-10rem;z-index:1}figure img,figure picture{position:relative;z-index:2}@media all and (min-width:800px){figure{width:100%}figcaption p{width:50%}.gallery{display:flex;flex-wrap:wrap;justify-content:flex-start}figure.gallery__figure{margin:0;padding:.25rem}.gallery__figure img,.gallery__figure picture{display:block;height:auto;width:100%;margin:0 auto}figure.gallery__figure--w-100{width:100%}figure.gallery__figure--w-50{width:50%}figure.gallery__figure--w-33{width:33%}figure.gallery__figure--w-25{width:25%}}p code,li code{background:var(--color-secondary);color:var(--color-main);padding:.125rem .25rem;border-radius:3px}.highlight{margin-left:calc(0rem - 2rem);width:calc(100% + 4rem)}.page-nav{background:var(--color-secondary);padding:1rem}.page-nav a:not(:last-of-type){margin-right:.5rem}.subscribe-via{background:var(--color-main);color:var(--color-font-fg);padding:.1rem 1rem}.subscribe-via a{color:var(--color-font-fg)}.page-nav--label{display:block;font-size:.75em}.article-content{padding-bottom:2rem;max-width:40rem}.article-single{width:100%;max-width:60rem;margin:0 auto}.article-header h1{font-size:3.2rem}.article-content ol,.article-content ul{margin-left:2rem}.article-list__header{margin-bottom:2rem}.article-list__intro,.page-content{background:var(--color-bg-box);padding:2rem;margin:3rem 2rem 2rem 0}.article.article--in-list{position:relative;margin-bottom:10rem;max-width:55rem}.article-preview__heading{font-size:2.75rem}.publish-date{font-size:.85em}.article-preview__publish-date a{opacity:.75;text-decoration:none}pre{padding:1rem;overflow:auto}.tag-list__item{display:inline-block;background:var(--color-main);color:var(--color-secondary);border-radius:3px;padding:.125rem .25rem;margin-bottom:.5rem;margin-right:.5rem}.tag-list__item a{color:var(--color-secondary)}@media all and (min-width:800px){.footer,.author,.support{display:flex;justify-content:space-between}.author .left,.support .left,.footer .left{margin-bottom:0}}.author .left,.support .left,.footer .left{margin-bottom:2rem}.author,.support{background:var(--color-main);color:var(--color-font-fg);padding:4rem 2rem}.support+.author{margin-top:0}.support{background:var(--color-secondary);color:var(--color-main);flex-direction:column}.support a{color:var(--color-main)}.author p,.support p{margin-bottom:0}@media all and (min-width:800px){.author .right{padding-left:2rem}.author .avatar{margin-left:2rem}}.author .avatar{max-width:200px;transition:all linear 60s}.author .avatar:hover{animation:avatar-hue linear 15s infinite}@keyframes avatar-hue{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}.age-note{background:#d46767;border:.35rem solid #b22222;padding:1rem 2rem;width:calc(100% + 4rem + 2px);margin-left:-2rem;margin-top:-2rem;color:#222}.tags-categories,.license{background:var(--color-bg-box);padding:2rem}.side-by-side img{width:auto;max-width:100%}@media all and (min-width:640px){.tags-categories{display:flex}.tags-categories .tags{margin-left:2rem}.side-by-side{display:flex;flex-direction:row;align-items:center;margin:2rem 0}.side-by-side.align-top{align-items:flex-start}.side-by-side.align-bottom{align-items:flex-end}.side-by-side__first{margin-bottom:3rem}.side-by-side__off-left{margin-left:-20vw}.side-by-side .small{max-width:40%;padding:2rem}.side-by-side .bg{background:var(--color-main);color:var(--color-secondary)}.side-by-side .wide{max-width:60%}.side-by-side img,.side-by-side figure{max-width:100%;margin:0}}.note{background:var(--color-main);color:var(--color-font-fg);padding:1rem 1rem 1rem 2rem;border-left:.5rem solid var(--color-secondary);margin:2rem 1rem;width:calc(100% - 1rem)}.note__heading{font-weight:700;display:block}.taxonomy-list{display:flex;padding-bottom:2rem;align-content:flex-end;justify-content:space-between;flex-wrap:wrap}.taxonomy__item{width:20%;height:2rem;display:inline-block;padding:2rem 0}.taxonomy__item-inner{padding:1rem;background:var(--color-main);color:var(--color-secondary)}.taxonomy__item a{color:var(--color-secondary)}.article-note__content{font-size:1.3rem}.language-nav{font-size:.75rem}.language-nav ul{display:inline-block;list-style:none}blockquote{font-size:110%;font-style:italic;text-indent:1rem;border-left:.25rem solid var(--color-main);padding:.25rem 0;padding-left:1rem}.series__box:before{content:"";display:block;position:absolute;width:100%;height:100%;left:-1rem;top:-1rem;z-index:-1;border:2px solid var(--color-main)}.series__box{float:left;padding:2rem;margin:2rem;position:relative;background:var(--color-secondary);z-index:1;display:block;margin-left:-5vw}.tag-list__item{display:inline-block;background:var(--color-secondary);color:var(--color-main);padding:.125rem .25rem;border-radius:0;margin-bottom:.5rem;margin-right:.5rem;position:relative;padding:.25em .5em;z-index:1}.tag-list__item:before{content:"";width:100%;height:100%;border:2px solid var(--color-main);left:-.45em;top:-.45em;display:block;position:absolute;z-index:-1;transition:all linear .1s}.tag-list__item:hover::before{top:-.1rem;left:-.1rem}.tag-list__item a{color:var(--color-main);text-decoration:none}ul.tag-list,ul.category-list{margin-top:1rem}table{background:#fff;border-spacing:unset;border-right:1px solid;border-left:1px solid;width:calc(100% + 30rem);margin-left:-15rem}thead{background:var(--color-main);color:var(--color-secondary)}thead th{text-align:left;padding-left:.5rem}tbody td{padding:.5rem;border-bottom:1px solid #333}.intro-text{display:none}body.section-tags .intro-text,body.section-categories .intro-text{display:block}.rating-list{font-size:2rem}.support-cause-list__wrapper{display:flex;margin-top:2rem;justify-content:space-between}.support-cause-list{text-indent:1rem;margin-bottom:1rem}.support-cause-list li{margin-left:1rem}.support-cause-list .head{margin-left:-1rem;font-size:1.25em;list-style:none}.wavy-text{z-index:1;position:relative;display:block}.wavy-text::before{content:attr(data-css-text);width:100%;display:block;color:transparent;top:0;position:absolute;left:0;font-size:110%;text-decoration:underline;text-decoration-style:wavy;text-decoration-color:var(--color-secondary);z-index:2}.wavy-text--invert{--tmp-color-main: var(--color-main);--color-main: var(--color-secondary);--color-secondary: var(--tmp-color-main)}.wavy-text--inline{display:inline-block}.main-grid{display:grid;grid-template-columns:2fr 3fr 1fr;grid-template-rows:1fr 1fr 1fr;grid-template-areas:"sidebar header header" "sidebar content content" "sidebar content content" "support support support" "footer footer footer"}.site-header{grid-column-start:sidebar;grid-column-end:sidebar;grid-row-start:1;grid-row-end:3}.site-main-content{grid-column-start:content;grid-column-end:content;grid-row-start:1;grid-row-end:4}.site-support{grid-column-start:support;grid-column-end:support;grid-row-start:4;grid-row-end:4;display:flex}.site-footer{grid-column-start:footer;grid-column-end:footer;grid-row-start:5;grid-row-end:5}@media all and (min-width:1200px){.nav-main{display:block;background:0 0;padding-top:2rem;padding-left:3rem}.nav-main li{display:block;margin:2rem 1rem;font-size:2rem}.nav-main li a{color:var(--color-main)}}.nav-item{display:block;position:relative}.nav-item--active a{font-size:120%;text-decoration:none}@media all and (max-width:1200px){.site-header{grid-column-start:sidebar;grid-column-end:header;grid-row-start:1;grid-row-end:1}.site-main-content{grid-column-start:sidebar;grid-column-end:content;grid-row-start:1;grid-row-end:4}.site-support{grid-column-start:support;grid-column-end:support;grid-row-start:4;grid-row-end:4;flex-direction:column}.author{border:1px solid var(--color-secondary);border-style:inset}.site-footer{grid-column-start:footer;grid-column-end:footer;grid-row-start:5;grid-row-end:5}.support-cause-list__wrapper{display:flex;justify-content:space-between;flex-direction:row}ul.nav-main{display:block;padding:1rem}.nav-item{display:inline-block;padding-right:1rem}}@media all and (max-width:800px){.main-grid{display:block}}.nav-footer li{display:inline-block;margin-right:1rem}</style></head><body class="type-page section-blog"><script type=text/javascript>(function(window,document,undefined){let theme=window.localStorage.getItem("kgde_theme");if(theme){var[colorMain,colorSecondary]=JSON.parse(theme).colors;document.body.style=`--color-main:${colorMain};--color-secondary:${colorSecondary}`;}else{let themes=[["#123D3C","#90F072"],["#403D58","#dea584"],["#400E3B","#DCC78A"],["#17098D","#EADD1C"],["#233B07","#FFDD6D"],["#37059F","#D1D99F"]]
var[colorMain,colorSecondary]=themes[Math.floor(Math.random()*themes.length)];document.body.style=`--color-main:${colorMain};--color-secondary:${colorSecondary}`;}
document.addEventListener('DOMContentLoaded',function(){let schema_btn=document.querySelector("#btn_schema");let theme=window.localStorage.getItem("kgde_theme");let text_keep=document.querySelector("#widget_color_changer_txt_keep").textContent;let text_random=document.querySelector("#widget_color_changer_txt_random").textContent;if(theme){schema_btn.textContent=text_random;}else{schema_btn.textContent=text_keep;}
schema_btn.style.display="block";schema_btn.addEventListener('click',function(e){if(theme){window.localStorage.removeItem("kgde_theme");window.location=window.location;}else{window.localStorage.setItem("kgde_theme",JSON.stringify({colors:[colorMain,colorSecondary]}));window.location=window.location;}});});}(window,document));</script><span style=display:none aria-hidden=true id=widget_color_changer_txt_keep>Keep current color theme</span>
<span style=display:none aria-hidden=true id=widget_color_changer_txt_random>Use random color theme</span><section class=main-grid><header class=site-header><nav role=navigation id=navigation aria-label="Main Navigation"><ul class=nav-main><li class=nav-item><a href=/>Home</a></li><li class=nav-item><a href=/blog/>Blog</a></li><li class=nav-item><a href=/about/>About</a></li><li class=nav-item><a href=/photography/>Photography</a></li></ul></nav><button id=btn_schema style=position:absolute;top:2.5em;right:2.5em;display:none></button></header><section class=site-main-content><main id=main class=main><section class=article-single><header class=article-header><h1>Deploy a static site with git</h1><p class=publish-date>Published on 01/17/2017</p></header><article class=article-content><div class=content><p>If you follow my blog you might recall that I switched from Jekyll hosted on GitHub to <a href=/farewell-jekyll-hello-hugo/>Hugo hosted on Uberspace</a>. Beside the fact I had to create a custom Hugo theme for myself and learn how to run a Hugo blog/website I also had to think about how I am going to deploy my website. Hugo is a static site generator and when executed (<code>$ hugo</code>) it compiles the site from Markdown and HTML templates into a <code>public</code> directory with lots of folders and HTML files. I could have fiddled with GitHub pages and created a <code>docs</code> directory with the live site inside but then I could have stayed with Jekyll in the first place. What made me move to Hugo beside the speed advantages was that I wanted to self-host my website again and use <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> to create SSL certificates and use HTTPS.</p><h3 id=so-what-is-a-static-site>So, what is a &ldquo;static site&rdquo;?</h3><blockquote><p>If you already know the answer, <a href=https://kevingimbel.de/blog/2017/01/deploy-a-static-site-with-git/#deploying-a-static-site>skip to the next section</a>!</p></blockquote><p>As the name suggest a static site is - well - <em>static</em>. There&rsquo;s no fancy Backend to login and no Database required to fetch content. All the content comes from <a href=https://github.com/kevingimbel/kevingimbel.com/tree/8cc66cd61774e28628848bcfde58d93b8ba3cae1/content/post>a bunch of markdown files</a>. These files are then compiled into a lot of HTML files based on <a href=https://github.com/kevingimbel/kevingimbel.com/tree/8cc66cd61774e28628848bcfde58d93b8ba3cae1/themes/kevingimbel/layouts>templates</a> which in turn a template engine to get content into place. The template for my <a href=/about/>/about/</a> page looks like this.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{ define &#34;main&#34; }}
&lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page wrap&#34;</span> <span style=color:#a6e22e>aria-labeldyby</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;title&#34;</span> <span style=color:#a6e22e>aria-describedby</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;desc&#34;</span>&gt;
  &lt;<span style=color:#f92672>header</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-header&#34;</span>&gt;
    &lt;<span style=color:#f92672>h2</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;title&#34;</span>&gt;{{ .Title }}&lt;/<span style=color:#f92672>h2</span>&gt;
  &lt;/<span style=color:#f92672>header</span>&gt;
  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-body&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;desc&#34;</span>&gt;
    {{ .Content }}
  &lt;/<span style=color:#f92672>div</span>&gt;
&lt;/<span style=color:#f92672>section</span>&gt;
{{ end }}
</code></pre></div><p>These 10 lines of code make up the default for single pages without a custom template. The words in curly brackets (e.g. <code>{{ .Content }}</code>) are variables filled by Hugo when the template is compiled. <code>{{ define "main" }}</code> defines the <code>main</code> block used inside the <a href=https://github.com/kevingimbel/kevingimbel.com/blob/8cc66cd61774e28628848bcfde58d93b8ba3cae1/themes/kevingimbel/layouts/_default/baseof.html#L36-L38><code>baseof.html</code> template</a>. All these templates make up the final site. So, despite being &ldquo;static&rdquo; when finished a static site is not so static! It can be flexible and you can use template logic like conditions (<code>if/else</code>, <code>with</code>), loops (<code>range</code>), and with Hugo even custom <a href=http://gohugo.io/extras/shortcodes/>shortcodes inside your markdown</a>.</p><p>At the end of the day we get a static site. This site is compiled from our source files and consists of folders (for URLs) and files (lots of <code>index.html</code> files!) so our server (apache, nginx, a node app) can deliver the content to the client. You might know that by default apache will serve any files such as <code>index.html</code> or <code>index.htm</code> when a route is requested unless you use a dynamic system such as PHP, Ruby, or NodeJS to serve your files. When you load this article at <a href=https://kevingimbel.com/deploy-a-static-site-with-git/>https://kevingimbel.com/deploy-a-static-site-with-git/</a> you request a folder, <code>deploy-a-static-site-with-git</code>, located inside the web root directory of my server and the <code>index.html</code> file inside this folder gets served to you by Apache. This is the basics how static websites work - they&rsquo;re simply HTML files and folders!</p><h3 id=deploying-a-static-site>Deploying a static site</h3><p>So far we learned that static sites are &ldquo;just&rdquo; folders and HTML files when generated. The only dependency they have to make them work is a Web Server. This can be apache, nginx, IIS, a simple nodeJS app, or even <code>python -m SimpleHTTPServer</code>. The most basic deployment for our website would be to upload the content of the generated folder (<code>public</code>) to our server using FTP. You might remember that this was the standard for having a website in the 90s were all websites were coded in Frames or tables. My first &ldquo;real website&rdquo; around 2008 was deployed that way. It was a mess.</p><p>What I did might be over-engineering in some way. I have all my source code in git so I set up a git repository on my server and push to this repository whenever I want to publish a new blog post, fix an issue, or change some templates/CSS. What&rsquo;s important about the repository is that it needs to be a <a href=https://git-scm.com/book/en/v2/Git-on-the-Server-Getting-Git-on-a-Server>bare repository</a>.</p><h4 id=setting-up-the-git-repository>Setting up the git repository</h4><p>The repository can be in any directory on your server which your user (the one you login with ssh) has access to. It should not be your web server root, that is <code>/var/www/</code> or <code>/var/www/html/</code> depending on your system since the files inside the bare repo could be exposed to the public this way. I created a directory outside the web server root in my users <code>home</code> directory, namely <code>$HOME/repository/kevingimbel.com</code>. The steps to setup the bare repository are as follows.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ ssh youruser@yourserver
$ mkdir -p $HOME/repository/kevingimbel.com
$ cd $HOME/repository/kevingimbel.com
$ git clone --bare https://github.com/kevingimbel/kevingimbel.com
</code></pre></div><p>These commands create the <code>repository</code> directory with a sub-directory <code>kevingimbel.com</code> inside. Inside this new directory I clone the git repository from GitHub with the <a href=https://git-scm.com/docs/git#git---bare><code>--bare</code></a> flag set. This will not checkout the source code but instead setup a git repository which we can push to or pull from - just like we would do from GitHub. What we need to build the static site is <code>hugo</code> as executable on the server -and the source code of the site. &ldquo;Wait!&rdquo; I hear you say, &ldquo;Didn&rsquo;t you just say there <em>is no source code?!</em>&rdquo; - that&rsquo;s right. The bare repository holds no source code but it can <em>be pushed to</em>! When we push our code to this remote we can use a <a href=https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks>git hook</a> to execute a set of scripts when a push is received. To do so, we use the <code>post-receive</code> hook. There are examples for each hook inside your newly created directory, e.g. <code>$HOME/repository/kevingimbel.com/hooks</code>.</p><h4 id=the-post-receive-hook>The post-receive hook</h4><p>The <code>post-receive</code> hook is executed after the git repository receives a new push. There are also <code>pre-</code> hooks which are executed before certain actions take place. You can use <code>pre-commit</code> for example to run a set of tests before you are able to write a commit message. I did this in for my example <a href=https://github.com/kevingimbel/nodesh/blob/master/scripts/pre-commit>node cli script nodesh</a> to run <a href=https://mochajs.org/>mocha</a> before I am able to commit. If a test fails and mocha exits with a non 0 code the commit is aborted. To build our static site after we push to the repository we will use the <code>post-receive</code> hook.</p><p>The <code>post-receive</code> hook I use can be found <a href=https://github.com/kevingimbel/kevingimbel.com/blob/master/scripts/post-receive>on GitHub</a>. The <code>post-receive</code> hook is a bash script which has access to a lot of built-in functions as well as all your users functions when a <code>source ~/.bash_profile</code> line is added to the top.</p><pre><code>#!/bin/sh

source ~/.bash_profile

repository_path=$HOME/repositories/kevingimbel.com
project_path=$HOME/subdomains/html
hugo_file_path=$HOME/hugosrc
css_path=$hugo_file_path/themes/kevingimbel/static/css
css_file=$css_path/style.css
base_theme_file=$hugo_file_path/themes/kevingimbel/layouts/_default/baseof.html
while read oldrev newrev refname
do
    # Get the name of the current branch
    branch=$(git rev-parse --symbolic --abbrev-ref $refname)

    # Checkout master branch
    if [ &quot;$branch&quot; = &quot;master&quot; ]; then
      git --work-tree=$hugo_file_path --git-dir=$repository_path checkout -f master

      # Get checksum of file
      file_shasum=$(shasum $css_file | awk -F' ' '{ print $1 }')

      # declare name of new CSS file
      new_css_file_name=&quot;style.$file_shasum.css&quot;

      # move style.css to the new CSS name (rename)
      mv $css_file $css_path/$new_css_file_name

      # replace name in template before hugo is build
      sed -i &quot;s/style\.css/${new_css_file_name}/g&quot; $base_theme_file

      hugo -b=&quot;https://kevingimbel.com&quot; -d=&quot;$project_path&quot; -s=&quot;$hugo_file_path&quot;
    fi
done
</code></pre><p>There happens quite a lot in my <code>post-receive</code> but the most import parts are the <code>git checkout</code> with the <a href=https://git-scm.com/docs/git#git---work-treeltpathgt><code>--work-tree</code></a> and <a href=https://git-scm.com/docs/git#git---git-dirltpathgt><code>--git-dir</code></a> to tell git were the git repository is (<code>--git-dir</code>) and were the files should be checked-out to (<code>--work-tree</code>). I checkout the files to <code>$HOME/hugosrc</code>where the source code of my website is placed just like on GitHub. I then <a href=https://github.com/kevingimbel/kevingimbel.com/blob/master/scripts/post-receive#L33-L42>do some magic</a> to re-write my <code>style.css</code> file to a hashed-file. This is used to force browsers to re-load the CSS when the file has changed. After the style.css re-write is done and the css path inside the <code>baseof.html</code> template is changed I build the site with <code>hugo</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>hugo -b<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://kevingimbel.com&#34;</span> -d<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$project_path<span style=color:#e6db74>&#34;</span> -s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$hugo_file_path<span style=color:#e6db74>&#34;</span>
</code></pre></div><p><code>-b</code> is the base url, <code>-d</code> is the destination and <code>-s</code> is the source. This way the static site is generated into my document root folder ($home/subdomains/html) with the new source files checked-out by git into the <code>$HOME/hugosrc</code> directory. Hugo generates the site and logs all output to the terminal - which is nice to have. In case of a build error hugo stops and does not overwrite the existing, working site. This is also nice to have.</p><p>What&rsquo;s important is that the <code>post-receive</code> hook is executable, so you have to run <code>$ chmod +x post-receive</code> to set the <code>x</code> (or e<code>x</code>ecute) permission on the file.</p><h4 id=pushing-to-the-new-repository>Pushing to the new repository</h4><p>To push your code to the new repository you need to add it as a <a href=https://git-scm.com/docs/git-remote>remote</a> to your local git repository. To do so, use <code>git remote add</code> filling in the remote name and remote url parameters.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># git remote add $name $url</span>
$ git remote add production ssh://YOUR_USER@YOUR_SERVER:/home/YOUR_USER/repository/gitrepo
</code></pre></div><p>Afterwards you are able to push your code with <code>git push production master</code>.</p><p>And that&rsquo;s it! This way I deploy and build my static site on my server using git. I am sure the script could be refactored and optimized more if I would dive deeper into git and git hooks - and I might do. At the moment it satisfies my needs and I am happy with it.</p></div></article></section><section class=tags-categories><section class=categories><h3>Categories</h3><ul class=tag-list><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under coding" href=https://kevingimbel.de/categories/coding/>coding</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under tools" href=https://kevingimbel.de/categories/tools/>tools</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under devops" href=https://kevingimbel.de/categories/devops/>devops</a></li></ul></section><section class=tags><h3>Tags</h3><ul class=tag-list><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with git" href=https://kevingimbel.de/tags/git/>git</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with hugo" href=https://kevingimbel.de/tags/hugo/>hugo</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with deployment" href=https://kevingimbel.de/tags/deployment/>deployment</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with bash" href=https://kevingimbel.de/tags/bash/>bash</a></li></ul></section></section></main></section><section class=site-support><section class=support><h4>Like this?</h4><p>If this content has helped you or your company, consider making a donation to a good cause.</p><p>For example, consider donating to the following causes:</p><div class=support-cause-list__wrapper><ul class=support-cause-list><li class=head><b>International</b></li><li><a rel=nofollow href=https://donate.doctorswithoutborders.org/onetime.cfm>Doctors without borders</a></li><li><a rel=nofollow href=https://www.amnesty.org/en/donate/>Amnesty International</a></li></ul><ul class=support-cause-list><li class=head><b>Germany</b></li><li><a rel=nofollow href=https://www.uno-fluechtlingshilfe.de/unterstuetzen/spenden/jetzt-spenden/>UNO FlÃ¼chtlingshilfe</a></li><li><a rel=nofollow href=https://www.amnesty.de/spenden>Amnesty</a></li><li><a rel=nofollow href=https://www.greenpeace.de/spenden>Greenpeace</a></li></ul></div></section><section class=author><div class=left><img src=/images/general/mask-moshed_hud020fe899933685564972ef591654996_344172_200x200_resize_q75_box.jpg alt="A colorful image of me wearing my DIY mask. The image has a colorful glitch effect." class=avatar></div><div class=right><p>Kevin Gimbel</p><p><strong>is a DevOps Engineer and avid (Video) Gamer</strong>. He&rsquo;s also interested in Sci-Fi, Cyberpunk, and dystopian books.</p><p><em>Wearing a mask is a good idea!</em></p><p>You can find out more <a href=/about/>about me</a> if you wish.</p></div></section></section><footer class="site-footer footer"><nav role=navigation id=footer-navigation aria-label="Secondary Navigation"><p>More sections on this site</p><ul class=nav-footer><li class=nav-item><a href=/reading/>Reading</a></li><li class=nav-item><a href=/art/>Art</a></li><li class=nav-item><a href=/now/>Now</a></li></ul></nav><div class=left><p>&copy; 2009 - 2020 Kevin Gimbel. <a href=https://github.com/kevingimbel/kevingimbel.de/blob/master/LICENSE title="View License on GitHub.com">License</a>. <a href=/blog/2020/01/no-tracking/>No Tracking</a>.</p><p><small>Follow me on <a href=https://bullgit.party/@kevin title="Follow my Mastodon Account on bullgit.party" rel=me>Mastodon @kevin@bullgit.party</a></small></p><p><small>Got more to say? Contact me on Matrix <a href=https://matrix.to/#/@kevingimbel:bullgit.science title="Contact me via Matrix">@kevingimbel:bullgit.science</a></a></small></p></div><div class=right><p><small class=xx-small>Found an issue? Edit this <a href=https://github.com/kevingimbel/kevingimbel.de/tree/master/content/blog/2017-01-17-deploy-a-static-site-with-git.md>page on GitHub.com</a></a></small></p><p><small class=xx-small>Made in Europe ðŸ‡ªðŸ‡º with love, <a href=/thanks>open source code</a> and <a href=https://gohugo.io/ title="Hugo static site generator" rel=nofollow>hugo</a>.<span class=fg-accent>&#9829;</span>.</small></p><p><small class=xx-small><a href=/legal>Imprint</a></small></p><p><small class=xx-small><code>Â¯\_(ãƒ„)_/Â¯</code></small></p></div></footer></section></body></html>