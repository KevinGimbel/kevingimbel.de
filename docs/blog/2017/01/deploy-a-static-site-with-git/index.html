<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Deploy a static site with git &mdash; KevOps ‚Äî DevOps, Cooking, and everything else I want to write about</title>
    <meta name="author" content="Kevin Gimbel">
    <meta name="description" content="Personal website of Kevin Gimbel, DevOps Engineer, about photography, books, coding, devops, gaming, and whatever comes in between">
    <meta keywords="git hugo deployment bash  blog coding tools devops  ">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßô‚Äç‚ôÇÔ∏è</text></svg>">
    
    
    
    <link rel="stylesheet" href="https://kevingimbel.de/sass/main.min.css">
    
    <link rel="stylesheet" href="https://kevingimbel.de/sass/page.min.css">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@kevingimbel">
    <meta name="twitter:creator" content="@_kevinatari">
    <meta name="twitter:title" content="Deploy a static site with git">
    <meta name="twitter:description" content="If you follow my blog you might recall that I switched from Jekyll hosted on GitHub to Hugo hosted on Uberspace. Beside the fact I had to create a custom Hugo theme for myself and learn how to run a Hugo blog/website I also had to think about how I am going to deploy my website. Hugo is a static site generator and when executed ($ hugo) it compiles the site from Markdown and HTML templates into a public directory with lots of folders and HTML files.">
    

</head>
<body class="type-page section-blog">
    <script type="text/javascript">(function(document,window,undefined){function css_to_int(cssStyleDeclaration,unitStr){return parseInt(cssStyleDeclaration.replace(unitStr,''));}
function pre_header_show(element){element.style.setProperty('margin-top',0);element.dataset.shown=true;}
function pre_header_hide(element){let this_height=window.getComputedStyle(element).height;element.style.setProperty('margin-top',`-${this_height}`);element.dataset.shown=false;}
function is_element_hidden(element){return['none'].indexOf(window.getComputedStyle(element).display)>-1;}
document.addEventListener('DOMContentLoaded',()=>{const pre_header_element=document.querySelector('#pre-header');const pre_header_toggle=document.querySelector('#pre-header-toggle');if(!is_element_hidden(pre_header_toggle)){pre_header_hide(pre_header_element);}
pre_header_toggle.addEventListener('click',(event)=>{if(pre_header_element.dataset.shown=="true"){pre_header_hide(pre_header_element);}else{pre_header_show(pre_header_element);}});window.addEventListener('resize',()=>{if(!is_element_hidden(pre_header_toggle)){pre_header_hide(pre_header_element);}else{pre_header_show(pre_header_element);}});});}(document,window));</script>
    
    <script type="text/javascript" src="https://kevingimbel.de/js/webcomponent.colorswitch.min.js"></script>
    <script type="text/javascript" src="https://kevingimbel.de/js/webcomponent.darkmode.min.js"></script>
    <script type="text/javascript" src="https://kevingimbel.de/js/webcomponent.fontsize.min.js"></script>
    <script type="text/javascript" src="https://kevingimbel.de/js/webcomponent.contentwidth.min.js"></script>
    <span style="display: none;" aria-hidden="true" id="widget_color_changer_txt_keep">Keep current color theme</span>
    <span style="display: none;" aria-hidden="true" id="widget_color_changer_txt_random">Use random color theme</span>
    
    <section class="main-grid">
    
        <header class="pre-header" id="pre-header">
            <kg-colorswitcher>Color theme</kg-colorswitcher>
            <kg-darkmode>Dark mode</kg-darkmode>
            <kg-fontsize>Font size</kg-fontsize>
            <kg-contentwidth>Content width</kg-contentwidth>
        </header>
    
        <header class="site-header">
            <nav role="navigation" id="navigation" aria-label="Main Navigation">
                <ul class="nav-main">
                    
                    <li class="nav-item">
                        <a href="/" data-perm="/blog/2017/01/deploy-a-static-site-with-git/" >Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="/blog/" data-perm="/blog/2017/01/deploy-a-static-site-with-git/" >Blog</a>
                    </li>
                    <li class="nav-item">
                        <a href="/about/" data-perm="/blog/2017/01/deploy-a-static-site-with-git/" >About</a>
                    </li>
                    <li class="nav-item">
                        <a href="/photography/" data-perm="/blog/2017/01/deploy-a-static-site-with-git/" >Photography</a>
                    </li><button id="pre-header-toggle" class="btn-preheader-toggle">Settings</button>
                    </ul>
                    </nav>
        </header>

    <section class="site-main-content">
<main id="main" class="main">
<section class="article-single" style="--this-border-radius: 29px 33px 58px 66px;"> 
        <header class="article-header">
            






<h1>Deploy a static site with git</h1>




<p class="publish-date">Published on 01/17/2017 </p>
        </header>
        <article class="article-content">

            
            <div class="content">
                <p>If you follow my blog you might recall that I switched from Jekyll hosted on GitHub to <a href="/farewell-jekyll-hello-hugo/">Hugo hosted on Uberspace</a>. Beside the fact I had to create a custom Hugo theme for myself and learn how to run a Hugo blog/website I also had to think about how I am going to deploy my website. Hugo is a static site generator and when executed (<code>$ hugo</code>) it compiles the site from Markdown and HTML templates into a <code>public</code> directory with lots of folders and HTML files. I could have fiddled with GitHub pages and created a <code>docs</code> directory with the live site inside but then I could have stayed with Jekyll in the first place. What made me move to Hugo beside the speed advantages was that I wanted to self-host my website again and use <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> to create SSL certificates and use HTTPS.</p>
<h3 id="so-what-is-a-static-site">So, what is a &ldquo;static site&rdquo;?</h3>
<blockquote>
<p>If you already know the answer, <a href="https://kevingimbel.de/blog/2017/01/deploy-a-static-site-with-git/#deploying-a-static-site
">skip to the next section</a>!</p>
</blockquote>
<p>As the name suggest a static site is - well - <em>static</em>. There&rsquo;s no fancy Backend to login and no Database required to fetch content. All the content comes from <a href="https://github.com/kevingimbel/kevingimbel.com/tree/8cc66cd61774e28628848bcfde58d93b8ba3cae1/content/post">a bunch of markdown files</a>. These files are then compiled into a lot of HTML files based on <a href="https://github.com/kevingimbel/kevingimbel.com/tree/8cc66cd61774e28628848bcfde58d93b8ba3cae1/themes/kevingimbel/layouts">templates</a> which in turn a template engine to get content into place. The template for my <a href="/about/">/about/</a> page looks like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ define &#34;main&#34; }}
&lt;<span style="color:#f92672">section</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;page wrap&#34;</span> <span style="color:#a6e22e">aria-labeldyby</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#a6e22e">aria-describedby</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;desc&#34;</span>&gt;
  &lt;<span style="color:#f92672">header</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;page-header&#34;</span>&gt;
    &lt;<span style="color:#f92672">h2</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;title&#34;</span>&gt;{{ .Title }}&lt;/<span style="color:#f92672">h2</span>&gt;
  &lt;/<span style="color:#f92672">header</span>&gt;
  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;page-body&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;desc&#34;</span>&gt;
    {{ .Content }}
  &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">section</span>&gt;
{{ end }}
</code></pre></div><p>These 10 lines of code make up the default for single pages without a custom template. The words in curly brackets (e.g. <code>{{ .Content }}</code>) are variables filled by Hugo when the template is compiled. <code>{{ define &quot;main&quot; }}</code> defines the <code>main</code> block used inside the <a href="https://github.com/kevingimbel/kevingimbel.com/blob/8cc66cd61774e28628848bcfde58d93b8ba3cae1/themes/kevingimbel/layouts/_default/baseof.html#L36-L38"><code>baseof.html</code> template</a>. All these templates make up the final site. So, despite being &ldquo;static&rdquo; when finished a static site is not so static! It can be flexible and you can use template logic like conditions (<code>if/else</code>, <code>with</code>), loops (<code>range</code>), and with Hugo even custom <a href="http://gohugo.io/extras/shortcodes/">shortcodes inside your markdown</a>.</p>
<p>At the end of the day we get a static site. This site is compiled from our source files and consists of folders (for URLs) and files (lots of <code>index.html</code> files!) so our server (apache, nginx, a node app) can deliver the content to the client. You might know that by default apache will serve any files such as <code>index.html</code> or <code>index.htm</code> when a route is requested unless you use a dynamic system such as PHP, Ruby, or NodeJS to serve your files. When you load this article at <a href="https://kevingimbel.com/deploy-a-static-site-with-git/">https://kevingimbel.com/deploy-a-static-site-with-git/</a> you request a folder, <code>deploy-a-static-site-with-git</code>, located inside the web root directory of my server and the <code>index.html</code> file inside this folder gets served to you by Apache. This is the basics how static websites work - they&rsquo;re simply HTML files and folders!</p>
<h3 id="deploying-a-static-site">Deploying a static site</h3>
<p>So far we learned  that static sites are &ldquo;just&rdquo; folders and HTML files when generated. The only dependency they have to make them work is a Web Server. This can be apache, nginx, IIS, a simple nodeJS app, or even <code>python -m SimpleHTTPServer</code>. The most basic deployment for our website would be to upload the content of the generated folder (<code>public</code>) to our server using FTP. You might remember that this was the standard for having a website in the 90s were all websites were coded in Frames or tables. My first &ldquo;real website&rdquo; around 2008 was deployed that way. It was a mess.</p>
<p>What I did might be over-engineering in some way. I have all my source code in git so I set up a git repository on my server and push to this repository whenever I want to publish a new blog post, fix an issue, or change some templates/CSS. What&rsquo;s important about the repository is that it needs to be a <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Getting-Git-on-a-Server">bare repository</a>.</p>
<h4 id="setting-up-the-git-repository">Setting up the git repository</h4>
<p>The repository can be in any directory on your server which your user (the one you login with ssh) has access to. It should not be your web server root, that is <code>/var/www/</code> or <code>/var/www/html/</code> depending on your system since the files inside the bare repo could be exposed to the public this way. I created a directory outside the web server root in my users <code>home</code> directory, namely <code>$HOME/repository/kevingimbel.com</code>. The steps to setup the bare repository are as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ssh youruser@yourserver
$ mkdir -p $HOME/repository/kevingimbel.com
$ cd $HOME/repository/kevingimbel.com
$ git clone --bare https://github.com/kevingimbel/kevingimbel.com
</code></pre></div><p>These commands create the <code>repository</code> directory with a sub-directory <code>kevingimbel.com</code> inside. Inside this new directory I clone the git repository from GitHub with the <a href="https://git-scm.com/docs/git#git---bare"><code>--bare</code></a> flag set. This will not checkout the source code but instead setup a git repository which we can push to or pull from - just like we would do from GitHub. What we need to build the static site is <code>hugo</code> as executable on the server -and the source code of the site. &ldquo;Wait!&rdquo; I hear you say, &ldquo;Didn&rsquo;t you just say there <em>is no source code?!</em>&rdquo; - that&rsquo;s right. The bare repository holds no source code but it can <em>be pushed to</em>! When we push our code to this remote we can use a <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">git hook</a> to execute a set of scripts when a push is received. To do so, we use the <code>post-receive</code> hook. There are examples for each hook inside your newly created directory, e.g. <code>$HOME/repository/kevingimbel.com/hooks</code>.</p>
<h4 id="the-post-receive-hook">The post-receive hook</h4>
<p>The <code>post-receive</code> hook is executed after the git repository receives a new push. There are also <code>pre-</code> hooks which are executed before certain actions take place. You can use <code>pre-commit</code> for example to run a set of tests before you are able to write a commit message. I did this in for my example <a href="https://github.com/kevingimbel/nodesh/blob/master/scripts/pre-commit">node cli script nodesh</a> to run <a href="https://mochajs.org/">mocha</a> before I am able to commit. If a test fails and mocha exits with a non 0 code the commit is aborted. To build our static site after we push to the repository we will use the <code>post-receive</code> hook.</p>
<p>The <code>post-receive</code> hook I use can be found <a href="https://github.com/kevingimbel/kevingimbel.com/blob/master/scripts/post-receive">on GitHub</a>. The <code>post-receive</code> hook is a bash script which has access to a lot of built-in functions as well as all your users functions when a <code>source ~/.bash_profile</code> line is added to the top.</p>
<pre><code>#!/bin/sh

source ~/.bash_profile

repository_path=$HOME/repositories/kevingimbel.com
project_path=$HOME/subdomains/html
hugo_file_path=$HOME/hugosrc
css_path=$hugo_file_path/themes/kevingimbel/static/css
css_file=$css_path/style.css
base_theme_file=$hugo_file_path/themes/kevingimbel/layouts/_default/baseof.html
while read oldrev newrev refname
do
    # Get the name of the current branch
    branch=$(git rev-parse --symbolic --abbrev-ref $refname)

    # Checkout master branch
    if [ &quot;$branch&quot; = &quot;master&quot; ]; then
      git --work-tree=$hugo_file_path --git-dir=$repository_path checkout -f master

      # Get checksum of file
      file_shasum=$(shasum $css_file | awk -F' ' '{ print $1 }')

      # declare name of new CSS file
      new_css_file_name=&quot;style.$file_shasum.css&quot;

      # move style.css to the new CSS name (rename)
      mv $css_file $css_path/$new_css_file_name

      # replace name in template before hugo is build
      sed -i &quot;s/style\.css/${new_css_file_name}/g&quot; $base_theme_file

      hugo -b=&quot;https://kevingimbel.com&quot; -d=&quot;$project_path&quot; -s=&quot;$hugo_file_path&quot;
    fi
done
</code></pre><p>There happens quite a lot in my <code>post-receive</code> but the most import parts are the  <code>git checkout</code> with the <a href="https://git-scm.com/docs/git#git---work-treeltpathgt"><code>--work-tree</code></a> and <a href="https://git-scm.com/docs/git#git---git-dirltpathgt"><code>--git-dir</code></a> to tell git were the git repository is (<code>--git-dir</code>) and were the files should be checked-out to (<code>--work-tree</code>). I checkout the files to <code>$HOME/hugosrc</code>where the source code of my website is placed just like on GitHub. I then <a href="https://github.com/kevingimbel/kevingimbel.com/blob/master/scripts/post-receive#L33-L42">do some magic</a> to re-write my <code>style.css</code> file to a hashed-file. This is used to force browsers to re-load the CSS when the file has changed. After the style.css re-write is done and the css path inside the  <code>baseof.html</code> template is changed I build the site with <code>hugo</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">hugo -b<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://kevingimbel.com&#34;</span> -d<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$project_path<span style="color:#e6db74">&#34;</span> -s<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$hugo_file_path<span style="color:#e6db74">&#34;</span>
</code></pre></div><p><code>-b</code> is the base url, <code>-d</code> is the destination and <code>-s</code> is the source. This way the static site is generated into my document root folder ($home/subdomains/html) with the new source files checked-out by git into the <code>$HOME/hugosrc</code> directory. Hugo generates the site and logs all output to the terminal - which is nice to have. In case of a build error hugo stops and does not overwrite the existing, working site. This is also nice to have.</p>
<p>What&rsquo;s important is that the <code>post-receive</code> hook is executable, so you have to run <code>$ chmod +x post-receive</code> to set the <code>x</code> (or e<code>x</code>ecute) permission on the file.</p>
<h4 id="pushing-to-the-new-repository">Pushing to the new repository</h4>
<p>To push your code to the new repository you need to add it as a <a href="https://git-scm.com/docs/git-remote">remote</a> to your local git repository. To do so, use <code>git remote add</code> filling in the remote name and remote url parameters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># git remote add $name $url</span>
$ git remote add production ssh://YOUR_USER@YOUR_SERVER:/home/YOUR_USER/repository/gitrepo
</code></pre></div><p>Afterwards you are able to push your code with <code>git push production master</code>.</p>
<p>And that&rsquo;s it! This way I deploy and build my static site on my server using git. I am sure the script could be refactored and optimized more if I would dive deeper into git and git hooks - and I might do. At the moment it satisfies my needs and I am happy with it.</p>

            </div>
        </article>
    </section>
</main>
</section>

    <section class="site-support">
<section class="tags-categories">
    

<section class="categories">
    <h3>Categories</h3>
    <ul class="tag-list">
        
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts categorized under coding"
                href="https://kevingimbel.de/categories/coding/">coding</a>
        </li>
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts categorized under tools"
                href="https://kevingimbel.de/categories/tools/">tools</a>
        </li>
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts categorized under devops"
                href="https://kevingimbel.de/categories/devops/">devops</a>
        </li></ul>
</section>

    

<section class="tags">
    <h3>Tags</h3>
    <ul class="tag-list">
        
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts tagged with git"
                href="https://kevingimbel.de/tags/git/">git</a>
        </li>
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts tagged with hugo"
                href="https://kevingimbel.de/tags/hugo/">hugo</a>
        </li>
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts tagged with deployment"
                href="https://kevingimbel.de/tags/deployment/">deployment</a>
        </li>
        <li class="tag-list__item">
            <a class="tag-list__link" title="View all posts tagged with bash"
                href="https://kevingimbel.de/tags/bash/">bash</a>
        </li></ul>
</section>

</section>
    <section class="article-nextprev">
  <article class="article__next">
      <span class="txt--bold">Next article</span><br>
  
      <a class="txt--medium" href="https://kevingimbel.de/blog/2017/01/2017-week-three/" title="2017, week three">2017, week three</a>
  
  </article>

  <article class="article__prev">
      <span class="txt--bold">Previous article</span><br>
  
      <a class="txt--medium" href="https://kevingimbel.de/blog/2017/01/2017-week-two/" title="2017, week two">2017, week two</a>
      
  </article>
</section>
    <section class="support">
    <h4>Like this?</h4>
    <p>If this content has helped you or your company, consider making a donation to a good cause.</p>
    <p>For example, consider donating to the following causes:</p>
    <div class="support-cause-list__wrapper">
        <ul class="support-cause-list">
            <li class="head"><b>International</b></li>
            <li><a rel="nofollow" href="https://donate.doctorswithoutborders.org/onetime.cfm">Doctors without borders</a></li>
            <li><a rel="nofollow" href="https://www.amnesty.org/en/donate/">Amnesty International</a></li>
        </ul>
        <ul class="support-cause-list">
            <li class="head"><b>Germany</b></li>
            <li><a rel="nofollow" href="https://www.uno-fluechtlingshilfe.de/unterstuetzen/spenden/jetzt-spenden/">UNO Fl√ºchtlingshilfe</a></li>
            <li><a rel="nofollow" href="https://www.amnesty.de/spenden">Amnesty</a></li>
            <li><a rel="nofollow" href="https://www.greenpeace.de/spenden">Greenpeace</a></li>
        </ul>
    </div>
</section>

    <section class="author">
    <div class="left">
        <img src="/images/general/kevin-gimbel-2020_hu6d6852ea5f23d3570eb4d6a09e2c1824_341389_200x200_resize_q75_box.jpg" alt="A Selfie of me" class="avatar">
    </div>
    <div class="right">
        <p>Kevin Gimbel</p>
<p><strong>is a DevOps Engineer and avid (Video) Gamer</strong>. He&rsquo;s also interested in Sci-Fi, Cyberpunk, and dystopian books.</p>
<p><em>Wearing a mask is a good idea!</em></p>
<p>You can find out more <a href="/about/">about me</a> if you wish.</p>

    </div>
</section>
</section>

    <footer class="site-footer footer">
        
        
        
        <nav role="navigation" id="footer-navigation" aria-label="Secondary Navigation">
        <p>More sections on this site </p>
        <ul class="nav-footer">
            <li class="nav-item">
                <a href="/reading/">Reading</a>
            </li>
            <li class="nav-item">
                <a href="/art/">Art</a>
            </li>
            <li class="nav-item">
                <a href="/now/">Now</a>
            </li></ul>
        </nav>
        


        <div class="left">
            <p> <a href="/blog/2020/01/no-tracking/">No Tracking</a>.</p>
            <p><small>Follow me on <a href="https://twitter.com/_kevinatari" title="Follow me on Twitter">Twitter @_kevinatari</a></small></p>
            </p>
        </div>
        <div class="right">
            <p><small class="xx-small">Found an issue? Edit this <a href="https://github.com/kevingimbel/kevingimbel.de/tree/master/content/en/blog/2017-01-17-deploy-a-static-site-with-git.md">page on GitHub.com</a></a></small></p>
            <p><small class="xx-small">Made in Europe üá™üá∫ with love, <a href="/thanks">open source code</a> and <a href="https://gohugo.io/" title="Hugo static site generator" rel="nofollow">hugo</a>.<span class="fg-accent">&hearts;</span>.</small>
            </p>
            <p><small class="xx-small"><a href="/legal">Imprint</a></small></p>
            <p><small class="xx-small"><code>¬Ø\_(„ÉÑ)_/¬Ø</code></small></p>
        </div>  
    </footer>
    </section>
    


</body>

</html>
