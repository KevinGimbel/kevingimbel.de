<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Getting into Performance Measurement &mdash; KevOps â€” DevOps, Cooking, and everything else I want to write about</title><meta name=author content="Kevin Gimbel"><meta name=description content="Personal website of Kevin Gimbel, DevOps Engineer, about photography, books, coding, devops, gaming, and whatever comes in between"><meta keywords="javascript tools css  blog coding tutorial frontend"><link rel=icon href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn6eZ4oCN4pmC77iPPC90ZXh0Pjwvc3ZnPg=="><style type=text/css>*{margin:0;padding:0;box-sizing:inherit}:root{--color-main: #403D58;--color-secondary: #dea584;--color-bg-box: #fefefe;--color-bg-page: #f1f1f1;--color-font-fg: #fff}html,body{box-sizing:border-box;font:20px/1.65 sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;background:var(--color-bg-page);border:.5rem solid var(--color-main)}::selection{background-color:var(--color-main);color:var(--color-secondary)}abbr{cursor:help;text-decoration:none;border-bottom:2px dotted var(--color-main)}a{color:var(--color-main);font-weight:700}.footer a,.author a,.intro-text a{color:var(--color-secondary);font-weight:700}.fg-accent{color:var(--color-secondary)}.x-small{font-size:.85rem}.xx-small{font-size:.65rem}.txt--ultra-large{font-size:4rem}.txt--large{font-size:2.5rem}.txt--medium{font-size:1.8rem}h1{font-size:2.46rem}h2{font-size:1.8rem}h3{font-size:1.6rem}.article-content h2,.article-content h3{margin-top:2rem}.section-headline{font-size:3.75em;margin-top:2rem;line-height:.75}.intro-splash{display:block;min-height:90vh;display:flex;align-items:center}.intro-text{padding:2rem;background:#222;color:var(--color-font-fg);font-size:140%}.footer{padding:2rem}hr{border:none;background:var(--color-main);height:2px}.footer{background:#222;color:var(--color-font-fg)}.main{padding-top:1.5rem;border-bottom:0;min-height:100vh}.main p{margin-top:1rem;margin-bottom:1.5rem}.exif{padding:.5rem;background:var(--color-secondary)}.exif li{display:inline-block;background:#333;color:#ccc;border-radius:3px;padding:.125rem .5rem;font-size:.8rem}.exif .label{font-size:.75rem}@media all and (max-width:800px){.exif li{margin-top:.5rem}.gallery img{max-width:100%}}figure img,figure picture{display:block;height:auto;width:auto;max-width:100%}.art figure img,.art figure picture,.photography figure img,.photography figure picture{width:auto}figcaption p{display:block;line-height:1.65;background:var(--color-secondary);color:var(--color-font-fg);margin-top:0;padding:.5rem;text-align:right;font-size:var(--font-small,.85rem)}figure{position:relative;z-index:1}figure+figure{margin-top:2rem}figcaption{display:flex;justify-content:flex-end}figcaption p{background:var(--color-secondary);color:var(--color-main);font-size:.85em;margin-top:1.5rem;position:relative}figcaption p::before{content:"";width:.15em;height:5rem;background:var(--color-secondary);position:absolute;left:1rem;top:-5rem;z-index:1}figure img,figure picture{position:relative;z-index:2}@media all and (min-width:800px){figure{width:100%}figcaption p{width:50%}.gallery{display:flex;flex-wrap:wrap;justify-content:flex-start}figure.gallery__figure{margin:0;padding:.25rem}.gallery__figure img,.gallery__figure picture{display:block;height:auto;width:100%;margin:0 auto}figure.gallery__figure--w-100{width:100%}figure.gallery__figure--w-50{width:50%}figure.gallery__figure--w-33{width:33%}figure.gallery__figure--w-25{width:25%}}p code,li code{background:var(--color-secondary);color:var(--color-main);padding:.125rem .25rem;border-radius:3px}.page-nav{background:var(--color-secondary);padding:1rem;margin-top:1rem}.page-nav a:not(:last-of-type){margin-right:.5rem}.subscribe-via{background:var(--color-main);color:var(--color-font-fg);padding:.1rem 1rem}.subscribe-via a{color:var(--color-font-fg)}.page-nav--label{display:block;font-size:.75em}.article-content{padding-bottom:2rem;max-width:40rem}.article-single{width:100%;max-width:60rem;margin:0 auto}.article-header h1{font-size:3.2rem}.article-content ol,.article-content ul{margin-left:2rem}.article-list__header{margin-bottom:2rem}.article-list__intro,.page-content{background:var(--color-bg-box);padding:2rem;margin:1rem 2rem 2rem 0}.article.article--in-list{position:relative;margin-bottom:10rem;max-width:55rem}.article-preview__heading{font-size:2.75rem}.publish-date{font-size:.85em}.article-preview__publish-date a{opacity:.75;text-decoration:none}pre{padding:1rem;overflow:auto}.tag-list__item{display:inline-block;background:var(--color-main);color:var(--color-secondary);border-radius:3px;padding:.125rem .25rem;margin-bottom:.5rem;margin-right:.5rem}.tag-list__item a{color:var(--color-secondary)}@media all and (min-width:800px){.footer,.author,.support{display:flex;justify-content:space-between}.author .left,.support .left,.footer .left{margin-bottom:0}}.author .left,.support .left,.footer .left{margin-bottom:2rem}.author,.support{background:var(--color-main);color:var(--color-font-fg);padding:4rem 2rem}.support+.author{margin-top:0}.support{background:var(--color-secondary);color:var(--color-main);flex-direction:column}.support a{color:var(--color-main)}.author p,.support p{margin-bottom:0}@media all and (min-width:800px){.author .right{padding-left:2rem}.author .avatar{margin-left:2rem}}.author .avatar{max-width:200px;transition:all linear 60s}.author .avatar:hover{animation:avatar-hue linear 15s infinite}@keyframes avatar-hue{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}.age-note{background:#d46767;border:.35rem solid #b22222;padding:1rem 2rem;color:#222}.tags-categories,.license{background:var(--color-bg-box);padding:2rem}.side-by-side img{width:auto;max-width:100%}@media all and (min-width:640px){.tags-categories{display:flex}.tags-categories .tags{margin-left:2rem}.side-by-side{display:flex;flex-direction:row;align-items:center;margin:2rem 0}.side-by-side.align-top{align-items:flex-start}.side-by-side.align-bottom{align-items:flex-end}.side-by-side__first{margin-bottom:3rem}.side-by-side__off-left{margin-left:-20vw}.side-by-side .small{max-width:40%;padding:2rem}.side-by-side .bg{background:var(--color-main);color:var(--color-secondary)}.side-by-side .wide{max-width:60%}.side-by-side img,.side-by-side figure{max-width:100%;margin:0}}.note{background:var(--color-main);color:var(--color-font-fg);padding:1rem 1rem 1rem 2rem;border-left:.5rem solid var(--color-secondary);margin:2rem 1rem}.note__heading{font-weight:700;display:block}.taxonomy-list{display:flex;padding-bottom:2rem;align-content:flex-end;justify-content:space-between;flex-wrap:wrap}.taxonomy__item{width:20%;height:2rem;display:inline-block;padding:2rem 0}.taxonomy__item-inner{padding:1rem;background:var(--color-main);color:var(--color-secondary)}.taxonomy__item a{color:var(--color-secondary)}.article-note__content{font-size:1.3rem}.language-nav{font-size:.75rem}.language-nav ul{display:inline-block;list-style:none}blockquote{font-size:110%;font-style:italic;text-indent:1rem;border-left:.25rem solid var(--color-main);padding:.25rem 0;padding-left:1rem}.series__box:before{content:"";display:block;position:absolute;width:100%;height:100%;left:-1rem;top:-1rem;z-index:-1;border:2px solid var(--color-main)}.series__box{float:left;padding:2rem;margin:2rem;position:relative;background:var(--color-secondary);z-index:1;display:block;margin-left:-5vw}.tag-list__item{display:inline-block;background:var(--color-secondary);color:var(--color-main);padding:.125rem .25rem;border-radius:0;margin-bottom:.5rem;margin-right:.5rem;position:relative;padding:.25em .5em;z-index:1}.tag-list__item:before{content:"";width:100%;height:100%;border:2px solid var(--color-main);left:-.45em;top:-.45em;display:block;position:absolute;z-index:-1;transition:all linear .1s}.tag-list__item:hover::before{top:-.1rem;left:-.1rem}.tag-list__item a{color:var(--color-main);text-decoration:none}ul.tag-list,ul.category-list{margin-top:1rem}table{background:#fff;border-spacing:unset;border-right:1px solid;border-left:1px solid;width:calc(100% + 30rem);margin-left:-15rem}thead{background:var(--color-main);color:var(--color-secondary)}thead th{text-align:left;padding-left:.5rem}tbody td{padding:.5rem;border-bottom:1px solid #333}.intro-text{display:none}body.section-tags .intro-text,body.section-categories .intro-text{display:block}.rating-list{font-size:2rem}.support-cause-list__wrapper{display:flex;margin-top:2rem;justify-content:space-between}.support-cause-list{text-indent:1rem;margin-bottom:1rem}.support-cause-list li{margin-left:1rem}.support-cause-list .head{margin-left:-1rem;font-size:1.25em;list-style:none}.wavy-text{z-index:1;position:relative;display:block}.wavy-text::before{content:attr(data-css-text);width:100%;display:block;color:transparent;top:0;position:absolute;left:0;font-size:110%;text-decoration:underline;text-decoration-style:wavy;text-decoration-color:var(--color-secondary);z-index:2}.wavy-text--invert{--tmp-color-main: var(--color-main);--color-main: var(--color-secondary);--color-secondary: var(--tmp-color-main)}.wavy-text--inline{display:inline-block}.main-grid{display:grid;grid-template-columns:2fr 3fr 1fr;grid-template-rows:1fr 1fr 1fr;grid-template-areas:"sidebar header header" "sidebar content content" "sidebar content content" "support support support" "footer footer footer"}.site-header{grid-column-start:sidebar;grid-column-end:sidebar;grid-row-start:1;grid-row-end:3}.site-main-content{grid-column-start:content;grid-column-end:content;grid-row-start:1;grid-row-end:4}.site-support{grid-column-start:support;grid-column-end:support;grid-row-start:4;grid-row-end:4;display:flex}.site-footer{grid-column-start:footer;grid-column-end:footer;grid-row-start:5;grid-row-end:5}@media all and (min-width:1200px){.nav-main{display:block;background:0 0;padding-top:2rem;padding-left:3rem}.nav-main li{display:block;margin:2rem 1rem;font-size:2rem}.nav-main li:first-of-type{margin-top:0}.nav-main li a{color:var(--color-main)}}.nav-item{display:block;position:relative}.nav-item--active a{font-size:120%;text-decoration:none}.settings summary{text-align:right}.settings{position:absolute;top:1.5rem;right:2rem}.settings-inner{font-size:.85rem;position:absolute;top:2rem;right:0;background:var(--color-secondary);padding:1rem}.settings details{position:relative;width:10rem}.settings-field{display:block;margin-bottom:1rem}.btn-color-switch{display:block}@media all and (max-width:1200px){body{border:.125rem solid var(--color-main)}.site-header{grid-column-start:sidebar;grid-column-end:header;grid-row-start:1;grid-row-end:1}.site-main-content{grid-column-start:sidebar;grid-column-end:content;grid-row-start:1;grid-row-end:4}.site-support{grid-column-start:support;grid-column-end:support;grid-row-start:4;grid-row-end:4;flex-direction:column}.author{border:1px solid var(--color-secondary);border-style:inset}.site-footer{grid-column-start:footer;grid-column-end:footer;grid-row-start:5;grid-row-end:5}.support-cause-list__wrapper{display:flex;justify-content:space-between;flex-direction:row}ul.nav-main{display:block;padding:1rem}.nav-item{display:inline-block;padding-right:1rem}.intro-splash__content .txt--ultra-large{font-size:1.8rem}.intro-splash__content .txt--large,.intro-splash__content .txt--medium{font-size:1.2rem}.main{padding:1rem .5rem}.support-cause-list__wrapper{flex-direction:column}.article-header h1,.article-preview__heading{font-size:2.2rem}.article-list__intro,.page-content{margin:2rem 0;padding:1rem}}@media all and (max-width:800px){.main-grid{display:block}}.nav-footer li{display:inline-block;margin-right:1rem}body.type-page .article-content p,body.type-page .article-content h1,body.type-page .article-content h2,body.type-page .article-content h3,body.type-page .article-content h4,body.type-page .article-content h5,body.type-page .article-content h6,body.type-page .article-content ul,body.type-page .article-header{padding-left:2rem;padding-right:2rem}body.type-page figure{max-width:70rem;max-width:fit-content;margin:0 auto}body.type-page .site-header{grid-column-start:sidebar;grid-column-end:header;grid-row-start:unset;grid-row-end:1}body.type-page .site-main-content{grid-column-start:sidebar;grid-column-end:content;grid-row-start:1;grid-row-end:4}body.type-page .article-single,body.type-page .article-content{max-width:100%}body.type-page .site-header{display:flex;align-items:center;justify-content:space-between}body.type-page .nav-main{padding-left:1rem;padding-top:0}body.type-page .nav-main li{display:inline-block}body.type-page:not(.section-blog) .main{padding-left:2rem}.w-40{width:40%}.w-50{width:50%}.w-60{width:60%}</style></head><body class="type-page section-blog"><script type=text/javascript>(function(window,document,undefined){let theme=window.localStorage.getItem("kgde_theme");if(theme){var[colorMain,colorSecondary]=JSON.parse(theme).colors;document.body.style=`--color-main:${colorMain};--color-secondary:${colorSecondary}`;}else{let themes=[["#123D3C","#90F072"],["#403D58","#dea584"],["#400E3B","#DCC78A"],["#17098D","#EADD1C"],["#233B07","#FFDD6D"],["#37059F","#D1D99F"]]
var[colorMain,colorSecondary]=themes[Math.floor(Math.random()*themes.length)];document.body.style=`--color-main:${colorMain};--color-secondary:${colorSecondary}`;}
document.addEventListener('DOMContentLoaded',function(){let schema_btn=document.querySelector("#btn_schema");let theme=window.localStorage.getItem("kgde_theme");let text_keep=document.querySelector("#widget_color_changer_txt_keep").textContent;let text_random=document.querySelector("#widget_color_changer_txt_random").textContent;if(theme){schema_btn.textContent=text_random;}else{schema_btn.textContent=text_keep;}
schema_btn.style.display="block";schema_btn.addEventListener('click',function(e){if(theme){window.localStorage.removeItem("kgde_theme");window.location=window.location;}else{window.localStorage.setItem("kgde_theme",JSON.stringify({colors:[colorMain,colorSecondary]}));window.location=window.location;}});let resizer=document.querySelector("#resizer");let article_content_el=document.querySelector(".article-single")||document.querySelector(".page-content");let width=window.localStorage.getItem("kgde_theme_width");if(!width){window.localStorage.setItem("kgde_theme_width",80);content_update_size(width,article_content_el);}
if(resizer){let opts=resizer.querySelectorAll("option");opts.forEach(entry=>{entry.selected=entry.value==width;})}
if(resizer&&article_content_el){if(width){content_update_size(width,article_content_el);}
resizer.addEventListener("change",(event)=>{let size=event.target.value;content_update_size(size,article_content_el);window.localStorage.setItem("kgde_theme_width",size);})}else{resizer.parentNode.style.display="none";}});function content_update_size(size,element){switch(size){case "full":element.style+="";break;default:element.style=`max-width: ${size}rem; margin: 0 auto;`;break;}}}(window,document));</script><span style=display:none aria-hidden=true id=widget_color_changer_txt_keep>Keep current color theme</span>
<span style=display:none aria-hidden=true id=widget_color_changer_txt_random>Use random color theme</span><section class=main-grid><header class=site-header><nav role=navigation id=navigation aria-label="Main Navigation"><ul class=nav-main><li class=nav-item><a href=/>Home</a></li><li class=nav-item><a href=/blog/>Blog</a></li><li class=nav-item><a href=/about/>About</a></li><li class=nav-item><a href=/photography/>Photography</a></li></ul></nav><section class=settings><details><summary>Settings</summary><div class=settings-inner><label for=btn_schema class=settings-field>Color settings
<button id=btn_schema class=btn-color-switch></button></label>
<label for=resizer class=settings-field>Content width
<select name=resize id=resizer>
<option value=40>Small</option>
<option value=60>Medium</option>
<option value=80>Large</option>
<option value=full>Full</option></select></label></div></details></section></header><section class=site-main-content><main id=main class=main><section class=article-single><header class=article-header><section class=age-note><h2>ATTENTION!</h2><p>This article is over 4 years old, it may be outdated!</p></section><h1>Getting into Performance Measurement</h1><p class=publish-date>Published on 03/10/2015</p></header><article class=article-content><div class=content><p>I&rsquo;ve spent the past week developing some features for our own website at work.
We&rsquo;re using WordPress and I almost always enjoy working with WordPress beside
Magento projects, it&rsquo;s way easier to keep an overview and with a good overview
of data flow and available data it&rsquo;s easier to measure and find performance
bottleneck. In the following post I want to examine my workflow and the way I
refactored our code base to increase the speed and overall performance of our
site.</p><h3 id=mesuring-load-times>Mesuring load times</h3><h4 id=webpagetestorg>WebPageTest.org</h4><p>With <a href=http://webpagetest.org>WebPageTest.org</a> it is quite easy to measure load
times, render times, asset loading times and non cached assets. WPT even shows
which assets should be cached or served via a CDN. Initially it checks for First
View and Repeat View and outputs a table of numbers and fancy graphics. The
thing I&rsquo;ve been most interested in were First View and Content Breakdown. The
Content Breakdown showed that ~66% of our landing page consist of images so
optimizing these images (see below) was a natural approach to boost performance.
When testing with WebPageTest I like to select the second fastest Internet
connection and a location somewhere relevant (for this site America, for our own
somewhere in Germany).</p><p>Then I watch the videos and see how the loading wents on. At first it was a
blank page and after 2.5s the page &ldquo;suddenly&rdquo; rendered all content at once. This
was not the desired behavior and so I started testing more.</p><h4 id=chrome-developer-tools>(Chrome) Developer Tools</h4><p>Using the Developer Tools I cleared the cache and measured a &ldquo;fresh&rdquo; load of our
site to see how content is loaded and where rendering starts. It turned out that
rendering was blocked by several JavaScript files (third party) and Google
Fonts, which where loaded from within our CSS files as well as the high amount
of non-optimized images. All these things can be seen in the Network Tab.</p><p>In Chrome there are 2 vertical lines - blue and red. The blue line marks the
time at which the <code>DOMContentLoaded</code> event is fired, that is when the DOM is
ready to be manipulated by JavaScript. The red line marks the moment where the
<code>load</code> event fires. This event indicates that all content (CSS, JavaScript,
Images, etc.) has been loaded.</p><blockquote><p>Measuring performance and finding obvious bottlenecks has become fairly easy
nowadays. With Tools like <a href=http://webpagetest.org>WebPageTest.org</a>, Developer
Tools or automated testing suits there are a ton of ways to analyze a
the loading behavior of a website.</p></blockquote><p>With these two tools I started tracking down the various performance issues.
First of all the blocking JavaScript and a bit of unused code.</p><h3 id=unused-code>Unused Code</h3><p>While checking the Network Tab in Chrome Dev Tools I&rsquo;ve seen that out of 16 Requests
one JavaScript Analytics Library was blocking the
rendering by almost 600-800ms. Because it was barely used I removed this one so
there was already a big improvement by removing unused or barely used code - one
should always check for unused plugins, libs and CSS - this is the most basic
&ldquo;improvement&rdquo; and optimization.</p><blockquote><p>Regularly refactor your code base to see where unused code exists or
code can be optimized. By ueing a Pre-Processor it&rsquo;s easy to remove the code
from production but keep it for later by using an <a href=http://sass-guidelin.es/#main-file>import system</a>.</p></blockquote><h3 id=minify>Minify</h3><p>Minifying files is always a good thing. No doubt. Use
<a href=https://github.com/mishoo/UglifyJS>Uglify</a> for JavaScript
and your favorite pre-proccessor&rsquo;s compress function.</p><h3 id=images>Images</h3><p>Next I found that our landing page is pretty image heavy, especially with a big
banner image. To reduce the size I searched for plugins to automate the process
but couldn&rsquo;t find a good one so I tried out <a href=http://pngquant.org/>PNGQuant</a> a
Command Line tool for PNG optimization. With this tool I could reduce the size
of almost any image by 50-70% which again reduced the load time by 100-200ms.</p><blockquote><p>Always optimize images, either with a tool before uploading them or with a
Plugin. Not optimizing images is a waste of time (literally) and bad for users.</p></blockquote><h3 id=fonts>Fonts</h3><p>As I mentioned earlier, rendering was also blocked by Google Fonts being
directly included into our Stylesheets. Out of curiosity I checked if loading it
asynchronously via the provided snippet from Google Fonts would help and indeed
it did! We saved almost 100ms simply by loading the Font files asynchronously.</p><p>On the very First View this can make the content &lsquo;jump&rsquo; a bit because the
initial view loads with a fallback font (sans-serif, for example) and then once
the Font is loaded from Google&rsquo;s CDN it replaces the old font with the new font
on-the-fly. This may looks ugly and if you absolutely can not live with it you
must take the 100ms-slower Pill and include the fonts in your CSS where they&rsquo;ll
be loaded before the CSS is rendered - therefore no delay.</p><p>Below is the function that&rsquo;ll load the fonts via a script tag that as the
<code>async</code> attribute set.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>WebFontConfig</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>google</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>families</span><span style=color:#f92672>:</span> [ <span style=color:#e6db74>&#39;Open+Sans:400,300,600:latin&#39;</span> ] }
};
(<span style=color:#66d9ef>function</span>() {
 <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wf</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;script&#39;</span>);
 <span style=color:#a6e22e>wf</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;https:&#39;</span> <span style=color:#f92672>==</span> document.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;https&#39;</span>
   <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;http&#39;</span>) <span style=color:#f92672>+</span>
 <span style=color:#e6db74>&#39;://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js&#39;</span>;
 <span style=color:#a6e22e>wf</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;text/javascript&#39;</span>;
 <span style=color:#a6e22e>wf</span>.<span style=color:#a6e22e>async</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;true&#39;</span>;
 <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span>
 document.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#39;script&#39;</span>)[<span style=color:#ae81ff>0</span>];
 <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>insertBefore</span>(<span style=color:#a6e22e>wf</span>, <span style=color:#a6e22e>s</span>);
 })(); 
</code></pre></div><blockquote><p>Font rendering from within CSS can block the overall load time of the CSS
file. Splitting out the fonts from the CSS and loading them via JavaScript (if
possible) may increase the initial load time of the website.</p></blockquote><h3 id=server-side-optimizations>Server-side optimizations</h3><p>There&rsquo;s quite a lot to do when optimizing from the server side. From things like
optimizing Queries, Caching Queries to using the variety of Apache or Nginx
Modules and settings to optimize the servers workflow. While we have our site at
a specific WordPress Hoster our access to server features is mainly limited to
their admin interface and using the <code>.htaccess</code> - which is what I did.</p><h4 id=expire-dates>Expire Dates</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html># caching for 1 month
&lt;<span style=color:#f92672>IfModule</span> <span style=color:#a6e22e>mod_expires</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>c</span>&gt;
 ExpiresActive On
 ExpiresByType text/css &#34;access plus 1 month&#34;
 ExpiresByType text/javascript &#34;access plus 1 month&#34;
 ExpiresByType text/html &#34;access plus 1 month&#34;
 ExpiresByType application/javascript &#34;access plus 1 month&#34;
 ExpiresByType image/gif &#34;access plus 1 month&#34;
 ExpiresByType image/jpeg &#34;access plus 1 month&#34;
 ExpiresByType image/png &#34;access plus 1 month&#34;
 ExpiresByType image/x-icon &#34;access plus 1 month&#34;

  &lt;<span style=color:#f92672>FilesMatch</span> <span style=color:#960050;background-color:#1e0010>&#34;\.(</span><span style=color:#a6e22e>gif</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#a6e22e>jpe</span><span style=color:#960050;background-color:#1e0010>?</span><span style=color:#a6e22e>g</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#a6e22e>png</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#a6e22e>ico</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#a6e22e>css</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#a6e22e>js</span><span style=color:#960050;background-color:#1e0010>)$&#34;</span>&gt;
    Header set Cache-Control &#34;public&#34;
  &lt;/<span style=color:#f92672>FilesMatch</span>&gt;
&lt;/<span style=color:#f92672>IfModule</span>&gt;
</code></pre></div><h4 id=compression-with-mod_deflate>Compression with mod_deflate</h4><p>With this snippet above we tell the server to cache certain file types by 1
month (if they don&rsquo;t change of course). This way the server can sent back the
files from its cache instead of re-generating the files all the time. Next I
used <code>mod_deflate</code> to compress the files before they are sent to the client.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html># Deflate Compression by FileType
&lt;<span style=color:#f92672>IfModule</span> <span style=color:#a6e22e>mod_deflate</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>c</span>&gt;
 AddOutputFilterByType DEFLATE text/plain
 AddOutputFilterByType DEFLATE text/html
 AddOutputFilterByType DEFLATE text/xml
 AddOutputFilterByType DEFLATE text/css
 AddOutputFilterByType DEFLATE text/javascript
 AddOutputFilterByType DEFLATE application/xml
 AddOutputFilterByType DEFLATE application/xhtml+xml
 AddOutputFilterByType DEFLATE application/rss+xml
 AddOutputFilterByType DEFLATE application/atom_xml
 AddOutputFilterByType DEFLATE application/javascript
 AddOutputFilterByType DEFLATE application/x-javascript
&lt;/<span style=color:#f92672>IfModule</span>&gt;
</code></pre></div><p>Now all our files are cached and gzip (compressed). Additionally our Hoster has
its own cache (Varnish) which should benefit to our sites overall performance, too.</p><blockquote><p>Use your servers configuration to serve compressed and/or cached files instead
of re-generating the files on every request. Make sure to cache static content
like images, javascript or css.</p></blockquote><h3 id=lazy-load-javascript>Lazy-load JavaScript</h3><p>We&rsquo;ve been using our own delayed load for JavaScript assets ever since I started
working at <a href=http://synoa.de>Synoa</a>. We use the following function to include
our minified JavaScript after the DOM is loaded, if possible.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>loadAfterDom</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>script</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;script&#39;</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>body</span>;
  
  <span style=color:#a6e22e>script</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;text/javascript&#39;</span>;
  <span style=color:#a6e22e>script</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;path/to/main.min.js&#39;</span>;
  
  document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>script</span>);
}
<span style=color:#75715e>// load the script when the DOM is constructed
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(window.<span style=color:#a6e22e>addEventListener</span>) {
  window.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;DOMContentLoaded&#39;</span>, <span style=color:#a6e22e>loadAfterDom</span>, <span style=color:#66d9ef>false</span>);
} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(window.<span style=color:#a6e22e>attachEvent</span>) {
  window.<span style=color:#a6e22e>attachEvent</span>(<span style=color:#e6db74>&#39;load&#39;</span>, <span style=color:#a6e22e>loadAfterDom</span>);  
} <span style=color:#66d9ef>else</span> {
  window.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadAfterDom</span>;  
}
</code></pre></div><p>This little script loads the <code>main.min.js</code> file after the DOM is constructed so
it doesn&rsquo;t block the rendering of the page.</p><blockquote><p>Lazy loading JavaScript only works when JavaScript is not needed for the
initial view (which it shouldn&rsquo;t). When you need JavaScript on render time to
hide elements, for example, it may be better to hide them initially and show them after the
page is loaded!</p></blockquote><h3 id=what-could-be-done-next>What could be done next?</h3><p>Next we could think about inlining our Critical Path CSS using a Grunt or Gulp
task, as Google PageSpeed suggests all the time. I&rsquo;ve yet never done this before
and need to try it before I can say if it&rsquo;s worth or not.</p><p>In another round we could review the entire code base and replace the legacy
Compass compiler with modern, <a href=https://github.com/sass/node-sass>node-sass</a> and
<a href=https://github.com/sass/libsass>Libsass</a>, a C++ implementation of Sass that is
a lot faster than Ruby, to increase compile performance. Most of the vendor
prefixing is done using own mixins or compass functions (which are legacy), so
handing the prefixing job to <a href=https://github.com/postcss/autoprefixer>Autoprefixer</a>
is another desirable improvement.</p><h3 id=result>Result</h3><p>At this point, our website performs at 900ms-1.2s in load time for the front page
and 700-800ms for most sub pages. Yet there is still optimization that need to
be done, especially the question on how to integrate the optimization into
everyone&rsquo;s workflow. While developers could use a grunt/gulp/cli task the people
who actually write content need an easy way to handle the optimization of
uploaded files. The last resort of more optimization is the server respond time
on which we don&rsquo;t have any influence.</p></div></article></section><section class=tags-categories><section class=categories><h3>Categories</h3><ul class=tag-list><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under coding" href=https://kevingimbel.de/categories/coding/>coding</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under tutorial" href=https://kevingimbel.de/categories/tutorial/>tutorial</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts categorized under frontend" href=https://kevingimbel.de/categories/frontend/>frontend</a></li></ul></section><section class=tags><h3>Tags</h3><ul class=tag-list><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with javascript" href=https://kevingimbel.de/tags/javascript/>javascript</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with tools" href=https://kevingimbel.de/tags/tools/>tools</a></li><li class=tag-list__item><a class=tag-list__link title="View all posts tagged with css" href=https://kevingimbel.de/tags/css/>css</a></li></ul></section></section></main></section><section class=site-support><section class=support><h4>Like this?</h4><p>If this content has helped you or your company, consider making a donation to a good cause.</p><p>For example, consider donating to the following causes:</p><div class=support-cause-list__wrapper><ul class=support-cause-list><li class=head><b>International</b></li><li><a rel=nofollow href=https://donate.doctorswithoutborders.org/onetime.cfm>Doctors without borders</a></li><li><a rel=nofollow href=https://www.amnesty.org/en/donate/>Amnesty International</a></li></ul><ul class=support-cause-list><li class=head><b>Germany</b></li><li><a rel=nofollow href=https://www.uno-fluechtlingshilfe.de/unterstuetzen/spenden/jetzt-spenden/>UNO FlÃ¼chtlingshilfe</a></li><li><a rel=nofollow href=https://www.amnesty.de/spenden>Amnesty</a></li><li><a rel=nofollow href=https://www.greenpeace.de/spenden>Greenpeace</a></li></ul></div></section><section class=author><div class=left><img src=/images/general/mask-moshed_hud020fe899933685564972ef591654996_344172_200x200_resize_q75_box.jpg alt="A colorful image of me wearing my DIY mask. The image has a colorful glitch effect." class=avatar></div><div class=right><p>Kevin Gimbel</p><p><strong>is a DevOps Engineer and avid (Video) Gamer</strong>. He&rsquo;s also interested in Sci-Fi, Cyberpunk, and dystopian books.</p><p><em>Wearing a mask is a good idea!</em></p><p>You can find out more <a href=/about/>about me</a> if you wish.</p></div></section></section><footer class="site-footer footer"><nav role=navigation id=footer-navigation aria-label="Secondary Navigation"><p>More sections on this site</p><ul class=nav-footer><li class=nav-item><a href=/reading/>Reading</a></li><li class=nav-item><a href=/art/>Art</a></li><li class=nav-item><a href=/now/>Now</a></li></ul></nav><div class=left><p>&copy; 2009 - 2020 Kevin Gimbel. <a href=https://github.com/kevingimbel/kevingimbel.de/blob/master/LICENSE title="View License on GitHub.com">License</a>. <a href=/blog/2020/01/no-tracking/>No Tracking</a>.</p><p><small>Follow me on <a href=https://bullgit.party/@kevin title="Follow my Mastodon Account on bullgit.party" rel=me>Mastodon @kevin@bullgit.party</a></small></p><p><small>Got more to say? Contact me on Matrix <a href=https://matrix.to/#/@kevingimbel:bullgit.science title="Contact me via Matrix">@kevingimbel:bullgit.science</a></a></small></p></div><div class=right><p><small class=xx-small>Found an issue? Edit this <a href=https://github.com/kevingimbel/kevingimbel.de/tree/master/content/blog/2015-03-10-getting-into-performance-measurement.md>page on GitHub.com</a></a></small></p><p><small class=xx-small>Made in Europe ðŸ‡ªðŸ‡º with love, <a href=/thanks>open source code</a> and <a href=https://gohugo.io/ title="Hugo static site generator" rel=nofollow>hugo</a>.<span class=fg-accent>&#9829;</span>.</small></p><p><small class=xx-small><a href=/legal>Imprint</a></small></p><p><small class=xx-small><code>Â¯\_(ãƒ„)_/Â¯</code></small></p></div></footer></section></body></html>